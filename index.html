<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SOSit - Emergency Navigation</title>
  <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps-web.min.js"></script>
  <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/services/services-web.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <link rel="stylesheet" href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps.css"/>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f4;
      color: #111;
      transition: background-color 0.3s, color 0.3s;
      position: relative;
      min-height: 100vh;
    }
    .dark-mode {
      background-color: #121212;
      color: #f4f4f4;
    }
    header {
      background-color: #d32f2f;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
    }
    #sidebar-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: #d32f2f;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 5px;
      cursor: pointer;
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 290px;
      height: 100%;
      overflow-y: auto;
      background-color: #fff;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 999;
    }
    .dark-mode #sidebar {
      background-color: #1e1e1e;
    }
    #sidebar.open {
      transform: translateX(0);
    }
    #sidebar h3 {
      margin-top: 0;
      font-size: 20px;
    }
    #quick-sos {
      position: fixed;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1002;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      font-size: 1.5em;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: blink 1.5s infinite;
      border: 5px solid transparent;
    }
    #quick-sos::after {
      content: '';
      position: fixed;
      bottom: -150px;
      left: 50%;
      transform: translateX(-50%);
      width: 200vw;
      height: 150px;
      border-radius: 50%;
      background-image: radial-gradient(circle, rgba(255, 0, 0, 0.5) 0%, rgba(255, 0, 0, 0) 70%);
      animation: glowing-background 2s infinite;
      z-index: 1001;
      box-shadow: 0 0 30px #d32f2f;
    }
    #controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 20px;
      font-size: 15px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #d32f2f;
      color: white;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #b71c1c;
    }
    #map-container {
      padding: 20px;
    }
    #map {
      width: 100%;
      height: 80vh;
      border-radius: 10px;
      border: 2px solid #ccc;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .sos-box {
      background-color: #d32f2f;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      cursor: pointer;
    }
    .sos-box input[type="checkbox"] {
      transform: scale(1.2);
      cursor: pointer;
    }
    .sos-box select {
      flex-grow: 1;
      padding: 5px;
      border-radius: 5px;
      border: none;
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
    }
    .sos-box select option {
        background-color: #d32f2f;
        color: white;
    }
    .sidebar-footer {
      margin-top: 380px;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      overflow: auto;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      position: relative;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    .dark-mode .modal-content {
      background-color: #1e1e1e;
      color: white;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      font-weight: bold;
      color: #d32f2f;
      cursor: pointer;
    }
    .modal-content label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    .modal-content input,
    .modal-content textarea {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .modal-content button {
      background-color: #388e3c;
      width: 100%;
      margin-top: 15px;
    }
    .modal-content button:hover {
      background-color: #2e7d32;
    }
    #saved-message {
      text-align: center;
      color: green;
      font-size: 14px;
      margin-top: 10px;
    }
    @keyframes blink {
      0% { background-color: #d32f2f; }
      50% { background-color: #1E88E5; }
      100% { background-color: #d32f2f; }
    }
    @keyframes glowing-background {
      0% {
        background-image: radial-gradient(circle, rgba(211, 47, 47, 0.6) 0%, rgba(211, 47, 47, 0) 70%);
        box-shadow: 0 0 30px #d32f2f;
      }
      50% {
        background-image: radial-gradient(circle, rgba(30, 136, 229, 0.6) 0%, rgba(30, 136, 229, 0) 70%);
        box-shadow: 0 0 30px #1E88E5;
      }
      100% {
        background-image: radial-gradient(circle, rgba(211, 47, 47, 0.6) 0%, rgba(211, 47, 47, 0) 70%);
        box-shadow: 0 0 30px #d32f2f;
      }
    }
  </style>
</head>
<body>
  <button id="sidebar-toggle">‚ò∞</button>
  <div id="sidebar">
    <h3>
      „Ö§„Ö§„Ö§„Ö§„Ö§„Ö§„Ö§
    </h3>
    <div class="sos-box">
      <label for="languageSelect">üåê Language:</label>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</option>
        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
        <option value="es">Espa√±ol (Spanish)</option>
        <option value="fr">Fran√ßais (French)</option>
        <option value="de">Deutsch (German)</option>
        <option value="ru">–†—É—Å—Å–∫–∏–π (Russian)</option>
        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</option>
        <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
        <option value="zh">‰∏≠Êñá (Chinese)</option>
      </select>
    </div>
    <label class="sos-box">
      <input type="checkbox" id="voiceToggle" /> üéôÔ∏è Voice SOS
    </label>
    <div class="sos-box" id="medicalBtn">üß© Medical Info</div>
    <div class="sidebar-footer">
      <label class="sos-box">
        <input type="checkbox" id="themeToggle" /> üåó Toggle Theme
      </label>
    </div>
  </div>
  <header id="appHeader">SOSit - Emergency Navigation</header>
  <div id="controls">
    <button id="hospitalBtn" onclick="searchNearby('hospital')">üè• Find Hospitals</button>
    <button id="policeBtn" onclick="searchNearby('police station')">üöì Find Police Stations</button>
    <button id="fireBtn" onclick="searchNearby('fire station')">üî• Find Fire Stations</button>
  </div>
  <div id="map-container">
    <div id="map"></div>
  </div>
  <button id="quick-sos">üö®</button>
  <div id="medicalModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h3 id="medicalModalTitle">üß© Medical ID / Emergency Info</h3>
      <form id="medicalForm">
        <label for="fullName" data-i18n="fullName">Full Name:</label>
        <input type="text" id="fullName" required>
        <label for="dob" data-i18n="dob">Date of Birth:</label>
        <input type="date" id="dob" required>
        <label for="bloodGroup" data-i18n="bloodGroup">Blood Group:</label>
        <input type="text" id="bloodGroup" required>
        <label for="allergies" data-i18n="allergies">Allergies:</label>
        <textarea id="allergies" rows="2"></textarea>
        <label for="medications" data-i18n="medications">Medications:</label>
        <textarea id="medications" rows="2"></textarea>
        <label for="conditions" data-i18n="conditions">Medical Conditions:</label>
        <textarea id="conditions" rows="2"></textarea>
        <label for="emergencyContact" data-i18n="emergencyContact">Emergency Contact:</label>
        <textarea id="emergencyContact" rows="2" required></textarea>
        <button type="submit" id="saveMedicalBtn">üíæ Save Info</button>
        <div id="saved-message"></div>
      </form>
    </div>
  </div>
  <div id="sosOptionsModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeSosModal">&times;</span>
      <h3 id="sosModalTitle">üö® Choose Emergency Service</h3>
      <button onclick="handleEmergency('Police', '100')" data-i18n="policeService">üöì Police</button>
      <button onclick="handleEmergency('Ambulance', '102')" data-i18n="ambulanceService">üöë Ambulance</button>
      <button onclick="handleEmergency('Fire Brigade', '101')" data-i18n="fireService">üî• Fire Brigade</button>
    </div>
  </div>
  <script>
    const apiKey = '9UgRJVBruTzjmNeO6gZrSB2loxP9ogDG';
    let map, userLocation, routeLayer;
    let poiMarkers = [];

    const translations = {
      en: {
        appHeader: "SOSit - Emergency Navigation",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è Voice SOS",
        medicalInfo: "üß© Medical Info",
        toggleTheme: "üåó Toggle Theme",
        findHospitals: "üè• Find Hospitals",
        findPoliceStations: "üöì Find Police Stations",
        findFireStations: "üî• Find Fire Stations",
        medicalModalTitle: "üß© Medical ID / Emergency Info",
        fullName: "Full Name:",
        dob: "Date of Birth:",
        bloodGroup: "Blood Group:",
        allergies: "Allergies:",
        medications: "Medications:",
        conditions: "Medical Conditions:",
        emergencyContact: "Emergency Contact:",
        saveInfo: "üíæ Save Info",
        infoSaved: "‚úÖ Information Saved Locally!",
        sosModalTitle: "üö® Choose Emergency Service",
        policeService: "üöì Police",
        ambulanceService: "üöë Ambulance",
        fireService: "üî• Fire Brigade",
        calling: "üìû Calling",
        locationNotAvailable: "Location not available.",
      },
      pa: {
        appHeader: "SOSit - ‡®ê‡®Æ‡®∞‡®ú‡©à‡®Ç‡®∏‡©Ä ‡®®‡©à‡®µ‡©Ä‡®ó‡©á‡®∏‡®º‡®®",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è ‡®µ‡©å‡®á‡®∏ SOS",
        medicalInfo: "üß© ‡®Æ‡©à‡®°‡©Ä‡®ï‡®≤ ‡®ú‡®æ‡®£‡®ï‡®æ‡®∞‡©Ä",
        toggleTheme: "üåó ‡®•‡©Ä‡®Æ ‡®¨‡®¶‡®≤‡©ã",
        findHospitals: "üè• ‡®π‡®∏‡®™‡®§‡®æ‡®≤ ‡®≤‡©±‡®≠‡©ã",
        findPoliceStations: "üöì ‡®™‡©Å‡®≤‡®ø‡®∏ ‡®∏‡®ü‡©á‡®∏‡®º‡®® ‡®≤‡©±‡®≠‡©ã",
        findFireStations: "üî• ‡®´‡®æ‡®á‡®∞ ‡®∏‡®ü‡©á‡®∏‡®º‡®® ‡®≤‡©±‡®≠‡©ã",
        medicalModalTitle: "üß© ‡®Æ‡©à‡®°‡©Ä‡®ï‡®≤ ID / ‡®ê‡®Æ‡®∞‡®ú‡©à‡®Ç‡®∏‡©Ä ‡®ú‡®æ‡®£‡®ï‡®æ‡®∞‡©Ä",
        fullName: "‡®™‡©Ç‡®∞‡®æ ‡®®‡®æ‡®Æ:",
        dob: "‡®ú‡®®‡®Æ ‡®Æ‡®ø‡®§‡©Ä:",
        bloodGroup: "‡®ñ‡©Ç‡®® ‡®ó‡®∞‡©Å‡©±‡®™:",
        allergies: "‡®ê‡®≤‡®∞‡®ú‡©Ä:",
        medications: "‡®¶‡®µ‡®æ‡®à‡®Ü‡®Ç:",
        conditions: "‡®Æ‡©à‡®°‡©Ä‡®ï‡®≤ ‡®π‡®æ‡®≤‡®§‡®æ‡®Ç:",
        emergencyContact: "‡®ê‡®Æ‡®∞‡®ú‡©à‡®Ç‡®∏‡©Ä ‡®∏‡©∞‡®™‡®∞‡®ï:",
        saveInfo: "üíæ ‡®ú‡®æ‡®£‡®ï‡®æ‡®∞‡©Ä ‡®∏‡©á‡®µ ‡®ï‡®∞‡©ã",
        infoSaved: "‚úÖ ‡®ú‡®æ‡®£‡®ï‡®æ‡®∞‡©Ä ‡®∏‡®•‡®æ‡®®‡®ï ‡®§‡©å‡®∞ '‡®§‡©á ‡®∏‡©á‡®µ ‡®ï‡©Ä‡®§‡©Ä ‡®ó‡®à ‡®π‡©à!",
        sosModalTitle: "üö® ‡®ê‡®Æ‡®∞‡®ú‡©à‡®Ç‡®∏‡©Ä ‡®∏‡©á‡®µ‡®æ ‡®ö‡©Å‡®£‡©ã",
        policeService: "üöì ‡®™‡©Å‡®≤‡®ø‡®∏",
        ambulanceService: "üöë ‡®ê‡®Ç‡®¨‡©Ç‡®≤‡©à‡®Ç‡®∏",
        fireService: "üî• ‡®´‡®æ‡®á‡®∞ ‡®¨‡©ç‡®∞‡®ø‡®ó‡©á‡®°",
        calling: "üìû ‡®ï‡®æ‡®≤ ‡®ï‡®∞ ‡®∞‡®ø‡®π‡®æ ‡®π‡©à",
        locationNotAvailable: "‡®ü‡®ø‡®ï‡®æ‡®£‡®æ ‡®â‡®™‡®≤‡®¨‡®ß ‡®®‡®π‡©Ä‡®Ç ‡®π‡©à‡•§",
      },
      hi: {
        appHeader: "SOSit - ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§®",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è ‡§µ‡•â‡§Ø‡§∏ SOS",
        medicalInfo: "üß© ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
        toggleTheme: "üåó ‡§•‡•Ä‡§Æ ‡§ü‡•â‡§ó‡§≤ ‡§ï‡§∞‡•á‡§Ç",
        findHospitals: "üè• ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç",
        findPoliceStations: "üöì ‡§™‡•Å‡§≤‡§ø‡§∏ ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§ñ‡•ã‡§ú‡•á‡§Ç",
        findFireStations: "üî• ‡§´‡§æ‡§Ø‡§∞ ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§ñ‡•ã‡§ú‡•á‡§Ç",
        medicalModalTitle: "üß© ‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ID / ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
        fullName: "‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ:",
        dob: "‡§ú‡§®‡•ç‡§Æ ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ:",
        bloodGroup: "‡§∞‡§ï‡•ç‡§§ ‡§∏‡§Æ‡•Ç‡§π:",
        allergies: "‡§è‡§≤‡§∞‡•ç‡§ú‡•Ä:",
        medications: "‡§¶‡§µ‡§æ‡§è‡§Ç:",
        conditions: "‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡§æ‡§Å:",
        emergencyContact: "‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï:",
        saveInfo: "üíæ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
        infoSaved: "‚úÖ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ó‡§à ‡§π‡•à!",
        sosModalTitle: "üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§∏‡•á‡§µ‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç",
        policeService: "üöì ‡§™‡•Å‡§≤‡§ø‡§∏",
        ambulanceService: "üöë ‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏",
        fireService: "üî• ‡§´‡§æ‡§Ø‡§∞ ‡§¨‡•ç‡§∞‡§ø‡§ó‡•á‡§°",
        calling: "üìû ‡§ï‡•â‡§≤ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à",
        locationNotAvailable: "‡§∏‡•ç‡§•‡§æ‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§",
      },
      bn: {
        appHeader: "SOSit - ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶®",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ SOS",
        medicalInfo: "üß© ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ ‡¶§‡¶•‡ßç‡¶Ø",
        toggleTheme: "üåó ‡¶•‡¶ø‡¶Æ ‡¶ü‡¶ó‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®",
        findHospitals: "üè• ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®",
        findPoliceStations: "üöì ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂ ‡¶∏‡ßç‡¶ü‡ßá‡¶∂‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®",
        findFireStations: "üî• ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶∂‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®",
        medicalModalTitle: "üß© ‡¶Æ‡ßá‡¶°‡¶ø‡¶ï‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø / ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶§‡¶•‡ßç‡¶Ø",
        fullName: "‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ:",
        dob: "‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:",
        bloodGroup: "‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™:",
        allergies: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ú‡¶ø:",
        medications: "‡¶ì‡¶∑‡ßÅ‡¶ß:",
        conditions: "‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ:",
        emergencyContact: "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó:",
        saveInfo: "üíæ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®",
        infoSaved: "‚úÖ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!",
        sosModalTitle: "üö® ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶™‡¶∞‡¶ø‡¶∑‡ßá‡¶¨‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®",
        policeService: "üöì ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂",
        ambulanceService: "üöë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏",
        fireService: "üî• ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶ø‡¶ó‡ßá‡¶°",
        calling: "üìû ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá",
        locationNotAvailable: "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§",
      },
      ta: {
        appHeader: "SOSit - ‡ÆÖ‡Æµ‡Æö‡Æ∞ ‡Æµ‡Æ¥‡Æø‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§‡Æ≤‡Øç",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç SOS",
        medicalInfo: "üß© ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æ§‡Øç ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç",
        toggleTheme: "üåó ‡Æ§‡ØÄ‡ÆÆ‡Øç ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡ØÅ",
        findHospitals: "üè• ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡ÆÆ‡Æ©‡Øà‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø",
        findPoliceStations: "üöì ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø",
        findFireStations: "üî• ‡Æ§‡ØÄ‡ÆØ‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆØ‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø",
        medicalModalTitle: "üß© ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ID / ‡ÆÖ‡Æµ‡Æö‡Æ∞‡Æ§‡Øç ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç",
        fullName: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡Æ™‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç:",
        dob: "‡Æ™‡Æø‡Æ±‡Æ®‡Øç‡Æ§ ‡Æ§‡Øá‡Æ§‡Æø:",
        bloodGroup: "‡Æá‡Æ∞‡Æ§‡Øç‡Æ§‡Æï‡Øç ‡Æï‡ØÅ‡Æ¥‡ØÅ:",
        allergies: "‡Æí‡Æµ‡Øç‡Æµ‡Ææ‡ÆÆ‡Øà:",
        medications: "‡ÆÆ‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ‡Æï‡Æ≥‡Øç:",
        conditions: "‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡Æ®‡Æø‡Æ≤‡Øà‡ÆÆ‡Øà‡Æï‡Æ≥‡Øç:",
        emergencyContact: "‡ÆÖ‡Æµ‡Æö‡Æ∞ ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ:",
        saveInfo: "üíæ ‡Æ§‡Æï‡Æµ‡Æ≤‡Øà‡Æö‡Øç ‡Æö‡Øá‡ÆÆ‡Æø",
        infoSaved: "‚úÖ ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÇ‡Æ∞‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡ÆÆ‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!",
        sosModalTitle: "üö® ‡ÆÖ‡Æµ‡Æö‡Æ∞ ‡Æö‡Øá‡Æµ‡Øà‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç",
        policeService: "üöì ‡Æï‡Ææ‡Æµ‡Æ≤‡Øç‡Æ§‡ØÅ‡Æ±‡Øà",
        ambulanceService: "üöë ‡ÆÜ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æ≤‡Æ©‡Øç‡Æ∏‡Øç",
        fireService: "üî• ‡Æ§‡ØÄ‡ÆØ‡Æ£‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æ™‡Øç ‡Æ™‡Æü‡Øà",
        calling: "üìû ‡ÆÖ‡Æ¥‡Øà‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ",
        locationNotAvailable: "‡Æá‡Æü‡ÆÆ‡Øç ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.",
      },
      es: {
        appHeader: "SOSit - Navegaci√≥n de Emergencia",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è SOS por voz",
        medicalInfo: "üß© Informaci√≥n M√©dica",
        toggleTheme: "üåó Cambiar Tema",
        findHospitals: "üè• Encontrar Hospitales",
        findPoliceStations: "üöì Encontrar Comisar√≠as",
        findFireStations: "üî• Encontrar Estaciones de Bomberos",
        medicalModalTitle: "üß© ID M√©dica / Informaci√≥n de Emergencia",
        fullName: "Nombre Completo:",
        dob: "Fecha de Nacimiento:",
        bloodGroup: "Grupo Sangu√≠neo:",
        allergies: "Alergias:",
        medications: "Medicamentos:",
        conditions: "Condiciones M√©dicas:",
        emergencyContact: "Contacto de Emergencia:",
        saveInfo: "üíæ Guardar Informaci√≥n",
        infoSaved: "‚úÖ Informaci√≥n guardada localmente.",
        sosModalTitle: "üö® Elegir Servicio de Emergencia",
        policeService: "üöì Polic√≠a",
        ambulanceService: "üöë Ambulancia",
        fireService: "üî• Bomberos",
        calling: "üìû Llamando a",
        locationNotAvailable: "Ubicaci√≥n no disponible.",
      },
      fr: {
        appHeader: "SOSit - Navigation d'urgence",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è SOS vocal",
        medicalInfo: "üß© Infos M√©dicales",
        toggleTheme: "üåó Changer de th√®me",
        findHospitals: "üè• Trouver des H√¥pitaux",
        findPoliceStations: "üöì Trouver des Postes de Police",
        findFireStations: "üî• Trouver des Casernes de Pompiers",
        medicalModalTitle: "üß© ID M√©dicale / Infos d'Urgence",
        fullName: "Nom Complet:",
        dob: "Date de Naissance:",
        bloodGroup: "Groupe Sanguin:",
        allergies: "Allergies:",
        medications: "M√©dicaments:",
        conditions: "Conditions M√©dicales:",
        emergencyContact: "Contact d'Urgence:",
        saveInfo: "üíæ Enregistrer les Infos",
        infoSaved: "‚úÖ Informations enregistr√©es localement !",
        sosModalTitle: "üö® Choisir un Service d'Urgence",
        policeService: "üöì Police",
        ambulanceService: "üöë Ambulance",
        fireService: "üî• Pompiers",
        calling: "üìû Appel en cours",
        locationNotAvailable: "Localisation non disponible.",
      },
      de: {
        appHeader: "SOSit - Notfall-Navigation",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è Sprach-SOS",
        medicalInfo: "üß© Medizinische Infos",
        toggleTheme: "üåó Thema wechseln",
        findHospitals: "üè• Krankenh√§user finden",
        findPoliceStations: "üöì Polizeistationen finden",
        findFireStations: "üî• Feuerwachen finden",
        medicalModalTitle: "üß© Medizinische ID / Notfall-Info",
        fullName: "Vollst√§ndiger Name:",
        dob: "Geburtsdatum:",
        bloodGroup: "Blutgruppe:",
        allergies: "Allergien:",
        medications: "Medikamente:",
        conditions: "Gesundheitszustand:",
        emergencyContact: "Notfallkontakt:",
        saveInfo: "üíæ Infos speichern",
        infoSaved: "‚úÖ Informationen lokal gespeichert!",
        sosModalTitle: "üö® Notdienst ausw√§hlen",
        policeService: "üöì Polizei",
        ambulanceService: "üöë Krankenwagen",
        fireService: "üî• Feuerwehr",
        calling: "üìû Anruf l√§uft",
        locationNotAvailable: "Standort nicht verf√ºgbar.",
      },
      ru: {
        appHeader: "SOSit - –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π SOS",
        medicalInfo: "üß© –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
        toggleTheme: "üåó –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É",
        findHospitals: "üè• –ù–∞–π—Ç–∏ –±–æ–ª—å–Ω–∏—Ü—ã",
        findPoliceStations: "üöì –ù–∞–π—Ç–∏ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–µ —É—á–∞—Å—Ç–∫–∏",
        findFireStations: "üî• –ù–∞–π—Ç–∏ –ø–æ–∂–∞—Ä–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏",
        medicalModalTitle: "üß© –ú–µ–¥. –∫–∞—Ä—Ç–∞ / –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
        fullName: "–ü–æ–ª–Ω–æ–µ –∏–º—è:",
        dob: "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:",
        bloodGroup: "–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏:",
        allergies: "–ê–ª–ª–µ—Ä–≥–∏–∏:",
        medications: "–õ–µ–∫–∞—Ä—Å—Ç–≤–∞:",
        conditions: "–ó–∞–±–æ–ª–µ–≤–∞–Ω–∏—è:",
        emergencyContact: "–ö–æ–Ω—Ç–∞–∫—Ç –Ω–∞ —Å–ª—É—á–∞–π –ß–ü:",
        saveInfo: "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ",
        infoSaved: "‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ!",
        sosModalTitle: "üö® –í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é —Å–ª—É–∂–±—É",
        policeService: "üöì –ü–æ–ª–∏—Ü–∏—è",
        ambulanceService: "üöë –°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å",
        fireService: "üî• –ü–æ–∂–∞—Ä–Ω–∞—è –æ—Ö—Ä–∞–Ω–∞",
        calling: "üìû –ó–≤–æ–Ω–æ–∫",
        locationNotAvailable: "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.",
      },
      ar: {
        appHeader: "SOSit - ÿßŸÑŸÖŸÑÿßÿ≠ÿ© ŸÅŸä ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è SOS ÿµŸàÿ™Ÿä",
        medicalInfo: "üß© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ∑ÿ®Ÿäÿ©",
        toggleTheme: "üåó ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ",
        findHospitals: "üè• ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿ¥ŸÅŸäÿßÿ™",
        findPoliceStations: "üöì ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ±ÿßŸÉÿ≤ ÿßŸÑÿ¥ÿ±ÿ∑ÿ©",
        findFireStations: "üî• ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ≠ÿ∑ÿßÿ™ ÿßŸÑÿ•ÿ∑ŸÅÿßÿ°",
        medicalModalTitle: "üß© ÿßŸÑŸáŸàŸäÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ© / ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
        fullName: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ:",
        dob: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ:",
        bloodGroup: "ŸÅÿµŸäŸÑÿ© ÿßŸÑÿØŸÖ:",
        allergies: "ÿßŸÑÿ≠ÿ≥ÿßÿ≥Ÿäÿ©:",
        medications: "ÿßŸÑÿ£ÿØŸàŸäÿ©:",
        conditions: "ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑ÿ®Ÿäÿ©:",
        emergencyContact: "ÿ¨Ÿáÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÅŸä ÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶:",
        saveInfo: "üíæ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™",
        infoSaved: "‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÖÿ≠ŸÑŸäÿßŸã!",
        sosModalTitle: "üö® ÿßÿÆÿ™ÿ± ÿÆÿØŸÖÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
        policeService: "üöì ÿßŸÑÿ¥ÿ±ÿ∑ÿ©",
        ambulanceService: "üöë ÿßŸÑÿ•ÿ≥ÿπÿßŸÅ",
        fireService: "üî• ÿßŸÑÿ•ÿ∑ŸÅÿßÿ°",
        calling: "üìû ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ",
        locationNotAvailable: "ÿßŸÑŸÖŸàŸÇÿπ ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠.",
      },
      ja: {
        appHeader: "SOSit - Á∑äÊÄ•„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è Èü≥Â£∞SOS",
        medicalInfo: "üß© ÂåªÁôÇÊÉÖÂ†±",
        toggleTheme: "üåó „ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà",
        findHospitals: "üè• ÁóÖÈô¢„ÇíÊé¢„Åô",
        findPoliceStations: "üöì Ë≠¶ÂØüÁΩ≤„ÇíÊé¢„Åô",
        findFireStations: "üî• Ê∂àÈò≤ÁΩ≤„ÇíÊé¢„Åô",
        medicalModalTitle: "üß© ÂåªÁôÇID / Á∑äÊÄ•ÊÉÖÂ†±",
        fullName: "„Éï„É´„Éç„Éº„É†:",
        dob: "ÁîüÂπ¥ÊúàÊó•:",
        bloodGroup: "Ë°ÄÊ∂≤Âûã:",
        allergies: "„Ç¢„É¨„É´„ÇÆ„Éº:",
        medications: "ÊäïËñ¨:",
        conditions: "ÁóÖÁä∂:",
        emergencyContact: "Á∑äÊÄ•ÈÄ£Áµ°ÂÖà:",
        saveInfo: "üíæ ÊÉÖÂ†±„Çí‰øùÂ≠ò",
        infoSaved: "‚úÖ ÊÉÖÂ†±„ÅØ„É≠„Éº„Ç´„É´„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åó„ÅüÔºÅ",
        sosModalTitle: "üö® Á∑äÊÄ•„Çµ„Éº„Éì„Çπ„ÇíÈÅ∏Êäû",
        policeService: "üöì Ë≠¶ÂØü",
        ambulanceService: "üöë ÊïëÊÄ•Ëªä",
        fireService: "üî• Ê∂àÈò≤",
        calling: "üìû ÈõªË©±„Çí„Åã„Åë„Å¶„ÅÑ„Åæ„Åô",
        locationNotAvailable: "Â†¥ÊâÄ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ",
      },
      zh: {
        appHeader: "SOSit - Á¥ßÊÄ•ÂØºËà™",
        quickSos: "üö®",
        voiceSos: "üéôÔ∏è ËØ≠Èü≥SOS",
        medicalInfo: "üß© ÂåªÁñó‰ø°ÊÅØ",
        toggleTheme: "üåó ÂàáÊç¢‰∏ªÈ¢ò",
        findHospitals: "üè• Êü•ÊâæÂåªÈô¢",
        findPoliceStations: "üöì Êü•ÊâæË≠¶ÂØüÂ±Ä",
        findFireStations: "üî• Êü•ÊâæÊ∂àÈò≤Â±Ä",
        medicalModalTitle: "üß© ÂåªÁñóID / Á¥ßÊÄ•‰ø°ÊÅØ",
        fullName: "ÂÖ®Âêç:",
        dob: "Âá∫ÁîüÊó•Êúü:",
        bloodGroup: "Ë°ÄÂûã:",
        allergies: "ËøáÊïè:",
        medications: "ËçØÁâ©:",
        conditions: "ÂåªÁñóÁä∂ÂÜµ:",
        emergencyContact: "Á¥ßÊÄ•ËÅîÁ≥ª‰∫∫:",
        saveInfo: "üíæ ‰øùÂ≠ò‰ø°ÊÅØ",
        infoSaved: "‚úÖ ‰ø°ÊÅØÂ∑≤Êú¨Âú∞‰øùÂ≠òÔºÅ",
        sosModalTitle: "üö® ÈÄâÊã©Á¥ßÊÄ•ÊúçÂä°",
        policeService: "üöì Ë≠¶ÂØü",
        ambulanceService: "üöë ÊïëÊä§ËΩ¶",
        fireService: "üî• Ê∂àÈò≤Èòü",
        calling: "üìû Ê≠£Âú®ÂëºÂè´",
        locationNotAvailable: "‰ΩçÁΩÆ‰∏çÂèØÁî®„ÄÇ",
      },
    };

    function setLanguage(lang) {
      const t = translations[lang];
      if (!t) return;

      document.getElementById('appHeader').innerText = t.appHeader;
      document.getElementById('quick-sos').innerText = t.quickSos;
      document.getElementById('voiceToggle').parentElement.lastChild.nodeValue = ` ${t.voiceSos}`;
      document.getElementById('medicalBtn').innerText = t.medicalInfo;
      document.getElementById('themeToggle').parentElement.lastChild.nodeValue = ` ${t.toggleTheme}`;
      document.getElementById('hospitalBtn').innerText = t.findHospitals;
      document.getElementById('policeBtn').innerText = t.findPoliceStations;
      document.getElementById('fireBtn').innerText = t.findFireStations;
      
      // Medical Modal
      document.getElementById('medicalModalTitle').innerText = t.medicalModalTitle;
      document.querySelector('label[for="fullName"]').innerText = t.fullName;
      document.querySelector('label[for="dob"]').innerText = t.dob;
      document.querySelector('label[for="bloodGroup"]').innerText = t.bloodGroup;
      document.querySelector('label[for="allergies"]').innerText = t.allergies;
      document.querySelector('label[for="medications"]').innerText = t.medications;
      document.querySelector('label[for="conditions"]').innerText = t.conditions;
      document.querySelector('label[for="emergencyContact"]').innerText = t.emergencyContact;
      document.getElementById('saveMedicalBtn').innerText = t.saveInfo;
      
      // SOS Modal
      document.getElementById('sosModalTitle').innerText = t.sosModalTitle;
      document.querySelector('#sosOptionsModal button:nth-of-type(1)').innerText = t.policeService;
      document.querySelector('#sosOptionsModal button:nth-of-type(2)').innerText = t.ambulanceService;
      document.querySelector('#sosOptionsModal button:nth-of-type(3)').innerText = t.fireService;
    }

    document.getElementById("languageSelect").addEventListener("change", (e) => {
      setLanguage(e.target.value);
    });

    // Initial language setup on page load
    setLanguage('en');

    function initMap() {
      navigator.geolocation.getCurrentPosition(position => {
        userLocation = [position.coords.longitude, position.coords.latitude];
        map = tt.map({
          key: apiKey,
          container: 'map',
          center: userLocation,
          zoom: 15
        });
        map.addControl(new tt.NavigationControl());
        new tt.Marker().setLngLat(userLocation).addTo(map);

        map.on('click', function (e) {
          const destination = [e.lngLat.lng, e.lngLat.lat];
          drawRouteTo(destination, true);
        });
      });
    }

    function searchNearby(query) {
      if (!userLocation) return alert(translations[document.getElementById('languageSelect').value].locationNotAvailable);
      poiMarkers.forEach(m => m.remove());
      poiMarkers = [];
      const [lon, lat] = userLocation;
      fetch(`https://api.tomtom.com/search/2/poiSearch/${query}.json?key=${apiKey}&lat=${lat}&lon=${lon}&radius=10000`)
        .then(res => res.json())
        .then(data => {
          data.results.forEach(poi => {
            const marker = new tt.Marker().setLngLat([poi.position.lon, poi.position.lat]).addTo(map);
            poiMarkers.push(marker);
            marker.getElement().addEventListener('click', () => drawRouteTo([poi.position.lon, poi.position.lat], true));
          });
        });
    }

    function drawRouteTo(destination, showPopup = false) {
      if (routeLayer) {
        map.removeLayer('route');
        map.removeSource('route');
      }
      tt.services.calculateRoute({
        key: apiKey,
        locations: [userLocation, destination]
      }).then(response => {
        const geojson = {
          type: 'Feature',
          geometry: {
            type: 'LineString',
            coordinates: response.routes[0].legs[0].points.map(p => [p.longitude, p.latitude])
          }
        };
        map.addLayer({
          id: 'route',
          type: 'line',
          source: { type: 'geojson', data: geojson },
          paint: { 'line-color': '#1E88E5', 'line-width': 5 }
        });
        routeLayer = 'route';

        if (showPopup) {
          const summary = response.routes[0].summary;
          const minutes = Math.round(summary.travelTimeInSeconds / 60);
          const distance = (summary.lengthInMeters / 1000).toFixed(2);
          new tt.Popup({ offset: 35 })
            .setLngLat(destination)
            .setHTML(`<strong>üöó Route Info:</strong><br>üïí ${minutes} mins<br>üìè ${distance} km`)
            .addTo(map);
        }
      });
    }

    initMap();

    document.getElementById("sidebar-toggle").addEventListener("click", () => {
      document.getElementById("sidebar").classList.toggle("open");
    });

    document.getElementById("themeToggle").addEventListener("change", (e) => {
      document.body.classList.toggle("dark-mode", e.target.checked);
    });

    const sosModal = document.getElementById("sosOptionsModal");
    const closeSosModal = document.getElementById("closeSosModal");
    document.getElementById("quick-sos").addEventListener("click", () => {
      sosModal.style.display = "flex";
    });
    closeSosModal.onclick = () => sosModal.style.display = "none";
    window.onclick = (e) => {
      if (e.target == sosModal) sosModal.style.display = "none";
    };

    function handleEmergency(serviceName, phoneNumber) {
      if (!userLocation) return alert(translations[document.getElementById('languageSelect').value].locationNotAvailable);
      fetch(`https://api.tomtom.com/search/2/reverseGeocode/${userLocation[1]},${userLocation[0]}.json?key=${apiKey}`)
        .then(res => res.json())
        .then(data => {
          const address = data.addresses[0]?.address?.freeformAddress || 'Unknown location';
          emailjs.send("service_s929gsa", "template_9jxocji", {
            to_name: "Admin",
            from_name: "SOSit App",
            message: `üö® Emergency Alert!\n\nService: ${serviceName}\nLocation:\n${address}\nLat: ${userLocation[1]}, Lon: ${userLocation[0]}`,
            reply_to: "aryansharvb@gmail.com"
          });
          alert(`${translations[document.getElementById('languageSelect').value].calling} ${serviceName}...`);
          window.location.href = `tel:${phoneNumber}`;
          sosModal.style.display = "none";
        });
    }

    const voiceToggle = document.getElementById("voiceToggle");
    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.continuous = true;
      recognition.interimResults = false;

      voiceToggle.addEventListener("change", () => {
        if (voiceToggle.checked) recognition.start();
        else recognition.stop();
      });

      recognition.onresult = (event) => {
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            const transcript = event.results[i][0].transcript.toLowerCase();
            if (transcript.includes("sos") || transcript.includes("help") || transcript.includes("emergency")) {
              document.getElementById("quick-sos").click();
            }
          }
        }
      };
    } else {
      voiceToggle.disabled = true;
      voiceToggle.parentElement.innerHTML += " <small>(Not supported)</small>";
    }

    const modal = document.getElementById("medicalModal");
    const openBtn = document.getElementById("medicalBtn");
    const closeBtn = document.getElementById("closeModal");

    openBtn.onclick = () => modal.style.display = "flex";
    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = (e) => {
      if (e.target == modal) modal.style.display = "none";
    };

    window.onload = function () {
      const fields = ['fullName', 'dob', 'bloodGroup', 'allergies', 'medications', 'conditions', 'emergencyContact'];
      fields.forEach(id => {
        const saved = localStorage.getItem(id);
        if (saved) document.getElementById(id).value = saved;
      });
    };
    document.getElementById("medicalForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const fields = ['fullName', 'dob', 'bloodGroup', 'allergies', 'medications', 'conditions', 'emergencyContact'];
      fields.forEach(id => {
        localStorage.setItem(id, document.getElementById(id).value);
      });
      document.getElementById("saved-message").innerText = translations[document.getElementById('languageSelect').value].infoSaved;
    });

    emailjs.init("9hAEAXdy5k9az18rX");
  </script>
  <script>
    (function () {
      if (!window.chatbase || window.chatbase("getState") !== "initialized") {
        window.chatbase = (...args) => {
          if (!window.chatbase.q) window.chatbase.q = [];
          window.chatbase.q.push(args);
        };
        window.chatbase = new Proxy(window.chatbase, {
          get(target, prop) {
            if (prop === "q") return target.q;
            return (...args) => target(prop, ...args);
          }
        });
      }
      const onLoad = function () {
        const script = document.createElement("script");
        script.src = "https://www.chatbase.co/embed.min.js";
        script.id = "-yLmCyXA4m_V1pQd17blW";
        script.domain = "www.chatbase.co";
        document.body.appendChild(script);
      };
      if (document.readyState === "complete") onLoad();
      else window.addEventListener("load", onLoad);
    })();
  </script>
</body>
</html>
